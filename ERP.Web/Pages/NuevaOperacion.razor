@page "/nueva-operacion"
@using Microsoft.AspNetCore.Components.Routing
@inject NavigationManager Navigation

<script src="https://cdn.tailwindcss.com"></script>

<div class="max-w-[1000px] mx-auto p-8 animate-in slide-in-from-bottom duration-500">
    
    @* --- CABECERA --- *@
    <div class="flex items-center justify-between mb-8 border-b border-slate-300 pb-4">
        <div>
            <h1 class="text-3xl font-black text-slate-800 uppercase tracking-tighter">Nueva OperaciÃ³n</h1>
            <p class="text-slate-500 font-medium italic text-sm">Registro de documento comercial / contable</p>
        </div>
        <NavLink href="" class="bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 py-2 rounded font-bold text-xs transition no-underline shadow-sm border border-slate-300">
            VOLVER AL PANEL
        </NavLink>
    </div>

    @if (operacionGuardada)
    {
        <div class="bg-green-600 text-white p-4 mb-6 rounded-lg shadow-xl flex items-center gap-3 animate-bounce">
            <span class="text-2xl">âœ…</span>
            <div>
                <p class="font-black uppercase text-sm">OperaciÃ³n Registrada</p>
                <p class="text-xs opacity-90">Los datos se han procesado correctamente en el sistema.</p>
            </div>
        </div>
    }

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        @* --- COLUMNA FORMULARIO (2/3) --- *@
        <div class="lg:col-span-2 bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden">
            <div class="bg-slate-900 p-4 text-white text-[10px] font-black uppercase tracking-[0.2em]">
                Entrada de Datos
            </div>
            
            <div class="p-8 space-y-6">
                @* Fila 1: Cliente y Fecha *@
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="block text-[10px] font-black text-slate-400 uppercase">Cliente</label>
                        <select @bind="modelo.Cliente" class="w-full bg-slate-50 border-2 border-slate-200 rounded-lg p-3 text-sm font-bold text-slate-700 outline-none focus:border-blue-600 transition">
                            <option value="">-- Seleccionar --</option>
                            <option>Comercial Arandina S.L.</option>
                            <option>Construcciones Ruiz S.A.</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-[10px] font-black text-slate-400 uppercase">Fecha OperaciÃ³n</label>
                        <input type="date" @bind="modelo.Fecha" class="w-full bg-slate-50 border-2 border-slate-200 rounded-lg p-3 text-sm font-bold text-slate-700 outline-none" />
                    </div>
                </div>

                @* Fila 2: Concepto *@
                <div class="space-y-2">
                    <label class="block text-[10px] font-black text-slate-400 uppercase">Concepto / DescripciÃ³n</label>
                    <input type="text" @bind="modelo.Concepto" @bind:event="oninput" placeholder="Â¿QuÃ© estÃ¡s facturando?" 
                           class="w-full bg-slate-50 border-2 border-slate-200 rounded-lg p-3 text-sm outline-none focus:border-blue-600" />
                </div>

                @* Fila 3: Importe e IVA *@
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="block text-[10px] font-black text-slate-400 uppercase">Base Imponible (â‚¬)</label>
                        <input type="number" step="0.01" @bind="modelo.Importe" @bind:event="oninput"
                               class="w-full bg-slate-900 text-white rounded-lg p-4 text-2xl font-mono font-bold outline-none ring-offset-2 focus:ring-2 focus:ring-blue-500" />
                    </div>
                    <div class="space-y-2">
                        <label class="block text-[10px] font-black text-slate-400 uppercase">Tipo IVA</label>
                        <select @bind="modelo.Iva" class="w-full bg-slate-50 border-2 border-slate-200 rounded-lg p-3 text-sm font-bold text-slate-700 h-[60px]">
                            <option value="21">21% General</option>
                            <option value="10">10% Reducido</option>
                            <option value="4">4% Superreducido</option>
                            <option value="0">0% Exento</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="bg-slate-50 p-6 border-t border-slate-200 flex justify-end">
                <button @onclick="Guardar" disabled="@(modelo.Importe <= 0 || string.IsNullOrEmpty(modelo.Concepto))"
                        class="bg-blue-700 hover:bg-blue-800 disabled:bg-slate-300 text-white px-10 py-4 rounded-xl font-black text-xs uppercase tracking-widest transition shadow-lg border-b-4 border-blue-950">
                    ðŸ’¾ Confirmar Registro
                </button>
            </div>
        </div>

        @* --- COLUMNA RESUMEN (1/3) --- *@
        <div class="space-y-6">
            <div class="bg-slate-900 text-white rounded-xl p-6 shadow-xl border border-slate-800">
                <h3 class="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-6">Resumen de Totales</h3>
                
                <div class="space-y-4 font-mono">
                    <div class="flex justify-between text-sm">
                        <span class="text-slate-400 text-xs">BASE:</span>
                        <span>@modelo.Importe.ToString("N2") â‚¬</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-slate-400 text-xs">IVA (@modelo.Iva%):</span>
                        <span>@ImporteIva.ToString("N2") â‚¬</span>
                    </div>
                    <div class="border-t border-slate-700 pt-4 flex justify-between items-end">
                        <span class="text-blue-400 font-black text-xs">TOTAL:</span>
                        <span class="text-3xl font-black">@Total.ToString("N2") â‚¬</span>
                    </div>
                </div>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                <p class="text-[10px] font-black text-blue-800 uppercase mb-2">Vista Previa</p>
                <p class="text-xs text-blue-900 leading-relaxed font-medium">
                    @(string.IsNullOrEmpty(modelo.Concepto) ? "Esperando concepto..." : modelo.Concepto)
                </p>
            </div>
        </div>
    </div>
</div>

@code {
    public class OperacionDTO {
        public string Cliente { get; set; } = "";
        public string Concepto { get; set; } = "";
        public decimal Importe { get; set; } = 0;
        public int Iva { get; set; } = 21;
        public DateTime Fecha { get; set; } = DateTime.Now;
    }

    private OperacionDTO modelo = new OperacionDTO();
    private bool operacionGuardada = false;

    // CÃ¡lculos en tiempo real
    private decimal ImporteIva => modelo.Importe * (modelo.Iva / 100m);
    private decimal Total => modelo.Importe + ImporteIva;

    private async Task Guardar() {
        operacionGuardada = true;
        await Task.Delay(2000);
        modelo = new OperacionDTO();
        operacionGuardada = false;
    }
}